knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
covid_raw <-
read_csv("data/10-20-2020.csv") %>%
filter(Country_Region == "US") %>%
select(
fips = FIPS,
county_name = Admin2,
state = Province_State,
confirmed = Confirmed,
deaths = Deaths
) %>%
mutate(fips = as.integer(fips))
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt", n_max = 15730)
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt")
race_raw
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt", n_max = 40497)
race_raw
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt")
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt", n_max = 15706)
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt", n_max = 15705)
race_raw
race_raw <-
read_tsv("data/Bridged-Race Population Estimates 1990-2019.txt", n_max = 15705) %>%
rename(
county = County,
county_code = `County Code`,
race = Race,
population = Population
) %>%
mutate(county_code = as.integer(county_code))
total_pop <-
race_raw %>%
filter(Notes == "Total") %>%
filter(!is.na(county_code)) %>%
select(county_code, population) %>%
rename(total_pop = population)
race <-
race_raw %>%
filter(is.na(Notes)) %>%
left_join(total_pop, by = "county_code") %>%
mutate(
race =
recode(
race,
"American Indian or Alaska Native" = "native",
"Asian or Pacific Islander" = "asian",
"Black or African American" = "black",
"White" = "white"
),
prop = population / total_pop
) %>%
select(-population, -`Race Code`, -Notes, -total_pop, -county) %>%
spread(key = race, value = prop)
covid <-
covid_raw %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(total_pop, by = c("fips" = "county_code"))
###Dividing into train, valid, test
set.seed(1234)
covid_rand <-
covid %>%
filter(!is.na(total_pop)) %>%
mutate(
group =
sample(c(1, 2, 3), size = nrow(.), prob= c(0.6, 0.2, 0.2), replace = TRUE)
) %>%
select(-fips, -county_name, -deaths)
train <- covid_rand %>% filter(group == 1) %>% select(-group)
valid <- covid_rand %>% filter(group == 2) %>% select(-group)
test <- covid_rand %>% filter(group == 3) %>% select(-group)
covid
lm_fit <- lm(confirmed ~ ., data = train)
train %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
test %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
covid <-
covid_raw %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(total_pop, by = c("fips" = "county_code"))
###Dividing into train, valid, test
set.seed(1234)
covid_rand <-
covid %>%
filter(!is.na(total_pop)) %>%
mutate(
group =
sample(c(1, 2, 3), size = nrow(.), prob= c(0.6, 0.2, 0.2), replace = TRUE)
) %>%
select(-fips, -county_name, -deaths, -white)
train <- covid_rand %>% filter(group == 1) %>% select(-group)
valid <- covid_rand %>% filter(group == 2) %>% select(-group)
test <- covid_rand %>% filter(group == 3) %>% select(-group)
lm_fit <- lm(confirmed ~ ., data = train)
train %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
test %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
race
race <-
race_raw %>%
filter(is.na(Notes)) %>%
left_join(total_pop, by = "county_code") %>%
mutate(
race =
recode(
race,
"American Indian or Alaska Native" = "native",
"Asian or Pacific Islander" = "asian",
"Black or African American" = "black",
"White" = "white"
),
prop = population / total_pop
)
race
race %>%
filter(county == "Alabama")
race %>%
filter(county == "California")
race <-
race_raw %>%
filter(is.na(Notes)) %>%
left_join(total_pop, by = "county_code") %>%
mutate(
race =
recode(
race,
"American Indian or Alaska Native" = "native",
"Asian or Pacific Islander" = "asian",
"Black or African American" = "black",
"White" = "white"
),
prop = population / total_pop
) %>%
select(-population, -`Race Code`, -Notes, -total_pop, -county) %>%
spread(key = race, value = prop)
race_raw <-
read_tsv("data/cdc_race.txt", n_max = 15705) %>%
rename(
county = County,
county_code = `County Code`,
race = Race,
population = Population
) %>%
mutate(county_code = as.integer(county_code))
#Getting total population of each county
total_pop <-
race_raw %>%
filter(Notes == "Total") %>%
filter(!is.na(county_code)) %>%
select(county_code, population) %>%
rename(total_pop = population)
race <-
race_raw %>%
filter(is.na(Notes)) %>%
left_join(total_pop, by = "county_code") %>%
mutate(
race =
recode(
race,
"American Indian or Alaska Native" = "native",
"Asian or Pacific Islander" = "asian",
"Black or African American" = "black",
"White" = "white"
),
prop = population / total_pop
) %>%
select(-population, -`Race Code`, -Notes, -total_pop, -county) %>%
spread(key = race, value = prop)
read_tsv("data/cdc_ethnicity.txt")
read_tsv("data/cdc_ethnicity.txt", n_max = 9427)
read_tsv("data/cdc_ethnicity.txt", n_max = 9427)
total_pop
read_tsv("data/cdc_ethnicity.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
ethnicity = Ethnicity,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(ethnicity == "Hispanic or Latino")
read_tsv("data/cdc_ethnicity.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
ethnicity = Ethnicity,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(ethnicity == "Hispanic or Latino") %>%
left_join(total_pop, by = "county_code")
# ethnicity <-
read_tsv("data/cdc_ethnicity.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
ethnicity = Ethnicity,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(ethnicity == "Hispanic or Latino") %>%
left_join(total_pop, by = "county_code") %>%
mutate(hispanic = population / total_pop) %>%
select(county_code, hispanic)
ethnicity <-
read_tsv("data/cdc_ethnicity.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
ethnicity = Ethnicity,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(ethnicity == "Hispanic or Latino") %>%
left_join(total_pop, by = "county_code") %>%
mutate(hispanic = population / total_pop) %>%
select(county_code, hispanic)
covid <-
covid_raw %>%
left_join(total_pop, by = c("fips" = "county_code")) %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(ethnicity, by = c("fips" = "county_code"))
covid
covid <-
covid_raw %>%
left_join(total_pop, by = c("fips" = "county_code")) %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(ethnicity, by = c("fips" = "county_code"))
###Dividing into train, valid, test
set.seed(1234)
covid_rand <-
covid %>%
filter(!is.na(total_pop)) %>%
mutate(
group =
sample(c(1, 2, 3), size = nrow(.), prob= c(0.6, 0.2, 0.2), replace = TRUE)
) %>%
select(-fips, -county_name, -deaths, -white) #dropping white because it is 1 - other races
train <- covid_rand %>% filter(group == 1) %>% select(-group)
valid <- covid_rand %>% filter(group == 2) %>% select(-group)
test <- covid_rand %>% filter(group == 3) %>% select(-group)
lm_fit <- lm(confirmed ~ ., data = train)
train %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
test %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
covid <-
covid_raw %>%
left_join(total_pop, by = c("fips" = "county_code")) %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(ethnicity, by = c("fips" = "county_code")) %>%
write_csv("covid_cleaned.csv")
knitr::opts_chunk$set(echo = TRUE)
covid <- read_csv("covid_cleaned.csv")
library(tidyverse)
covid <- read_csv("covid_cleaned.csv")
###Dividing into train, valid, test
set.seed(1234)
covid_rand <-
covid %>%
filter(!is.na(total_pop)) %>%
mutate(
group =
sample(c(1, 2, 3), size = nrow(.), prob= c(0.6, 0.2, 0.2), replace = TRUE)
) %>%
select(-fips, -county_name, -deaths, -white) #dropping white because it is 1 - other races
train <- covid_rand %>% filter(group == 1) %>% select(-group)
valid <- covid_rand %>% filter(group == 2) %>% select(-group)
test <- covid_rand %>% filter(group == 3) %>% select(-group)
lm_fit <- lm(confirmed ~ ., data = train)
train %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
test %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
knitr::opts_chunk$set(echo = TRUE)
read_tsv("data/cdc_gender.txt")
read_tsv("data/cdc_gender.txt", n_max = 9427)
gender <-
read_tsv("data/cdc_gender.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
gender = Gender,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(gender == "female") %>%
left_join(total_pop, by = "county_code") %>%
mutate(female = population / total_pop) %>%
select(county_code, female)
gender
read_tsv("data/cdc_gender.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
gender = Gender,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(gender == "female")
read_tsv("data/cdc_gender.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
gender = Gender,
population = Population
) %>%
mutate(county_code = as.integer(county_code))
gender <-
read_tsv("data/cdc_gender.txt", n_max = 9427) %>%
rename(
county = County,
county_code = `County Code`,
gender = Gender,
population = Population
) %>%
mutate(county_code = as.integer(county_code)) %>%
filter(gender == "Female") %>%
left_join(total_pop, by = "county_code") %>%
mutate(female = population / total_pop) %>%
select(county_code, female)
gender
covid <-
covid_raw %>%
left_join(total_pop, by = c("fips" = "county_code")) %>%
left_join(race, by = c("fips" = "county_code")) %>%
left_join(ethnicity, by = c("fips" = "county_code")) %>%
left_join(gender, by = c("fips" = "county_code")) %>%
write_csv("covid_cleaned.csv")
covid
library(tidyverse)
covid <- read_csv("covid_cleaned.csv")
###Dividing into train, valid, test
set.seed(1234)
covid_rand <-
covid %>%
filter(!is.na(total_pop)) %>%
mutate(
group =
sample(c(1, 2, 3), size = nrow(.), prob= c(0.6, 0.2, 0.2), replace = TRUE)
) %>%
select(-fips, -county_name, -deaths, -white) #dropping white because it is 1 - other races
train <- covid_rand %>% filter(group == 1) %>% select(-group)
valid <- covid_rand %>% filter(group == 2) %>% select(-group)
test <- covid_rand %>% filter(group == 3) %>% select(-group)
lm_fit <- lm(confirmed ~ ., data = train)
train %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
test %>%
mutate(
pred = predict(lm_fit, .),
sqr_error = (confirmed - pred)^2
) %>%
summarize(mse = mean(sqr_error, na.rm = TRUE))
lm_fit
